version: '3.8'
services:
  runner:
    image: python:3.11-slim
    container_name: verity-runner
    working_dir: /workdir/python-tools
    volumes:
      - ./:/workdir:cached
    command: ["sh","-c","cd /workdir/python-tools && python -m uvicorn test_runner_server:app --host 0.0.0.0 --port 8010"]
    ports:
      - "8010:8010"
    networks:
      - verity-net

  static:
    image: python:3.11-slim
    container_name: verity-static
    working_dir: /workdir/public
    volumes:
      - ./:/workdir:cached
    command: ["sh","-c","cd /workdir/public && python -m http.server 3001 0.0.0.0"]
    ports:
      - "3001:3001"
    networks:
      - verity-net

  prometheus:
    image: prom/prometheus:latest
    container_name: verity-prometheus
    volumes:
      - ./python-tools/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"
    networks:
      - verity-net

  grafana:
    image: grafana/grafana:latest
    container_name: verity-grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    ports:
      - "3000:3000"
    networks:
      - verity-net

networks:
  verity-net:
    driver: bridge
