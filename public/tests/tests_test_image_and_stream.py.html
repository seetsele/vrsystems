<!doctype html><html><head><meta charset="utf-8"><title>Tests: tests\test_image_and_stream.py</title><link rel="stylesheet" href="tests.css"></head><body><div class="wrap"><h1>Tests: tests\test_image_and_stream.py</h1><p><a href="index.html">Back to tests index</a></p><div class="items"><h2>Test functions</h2><ul><li>test_image_forensics_with_image_url</li><li>test_image_forensics_deepfake_mention</li><li>test_realtime_stream_high_viral</li><li>test_realtime_stream_medium</li></ul></div><h2>Source</h2><pre class="source">import os, sys
ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), &#x27;..&#x27;))
sys.path.insert(0, os.path.join(ROOT, &#x27;python-tools&#x27;))
from fastapi.testclient import TestClient
import api_server_v9 as server

client = TestClient(server.app)


def test_image_forensics_with_image_url():
    resp = client.post(&#x27;/tools/image-forensics&#x27;, json={&#x27;content&#x27;: &#x27;https://example.com/photo.jpg&#x27;})
    assert resp.status_code == 200
    data = resp.json()
    assert data[&#x27;tool&#x27;] == &#x27;Image Forensics&#x27;
    assert any(f[&#x27;type&#x27;] == &#x27;analysis&#x27; for f in data[&#x27;findings&#x27;])
    assert &#x27;No obvious manipulation&#x27; in data[&#x27;summary&#x27;] or data[&#x27;verdict&#x27;] == &#x27;likely_authentic&#x27;


def test_image_forensics_deepfake_mention():
    resp = client.post(&#x27;/tools/image-forensics&#x27;, json={&#x27;content&#x27;: &#x27;This looks like a deepfake of the politician&#x27;})
    assert resp.status_code == 200
    data = resp.json()
    assert data[&#x27;tool&#x27;] == &#x27;Image Forensics&#x27;
    assert any(f[&#x27;type&#x27;] == &#x27;deepfake_mention&#x27; for f in data[&#x27;findings&#x27;])
    assert data[&#x27;verdict&#x27;] in (&#x27;needs_review&#x27;, &#x27;likely_manipulated&#x27;)


def test_realtime_stream_high_viral():
    resp = client.post(&#x27;/tools/realtime-stream&#x27;, json={&#x27;content&#x27;: &#x27;Breaking: new viral video trending now&#x27;})
    assert resp.status_code == 200
    data = resp.json()
    assert data[&#x27;tool&#x27;] == &#x27;Real-Time Stream&#x27;
    assert data[&#x27;spread_velocity&#x27;] == &#x27;high&#x27;
    assert &#x27;high_spread&#x27; in data[&#x27;verdict&#x27;]


def test_realtime_stream_medium():
    resp = client.post(&#x27;/tools/realtime-stream&#x27;, json={&#x27;content&#x27;: &#x27;News update: regional report posted&#x27;})
    assert resp.status_code == 200
    data = resp.json()
    assert data[&#x27;tool&#x27;] == &#x27;Real-Time Stream&#x27;
    assert data[&#x27;spread_velocity&#x27;] == &#x27;medium&#x27;
    assert &#x27;medium_spread&#x27; in data[&#x27;verdict&#x27;]
</pre></div></body></html>